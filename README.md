# Распознавание корректно заполненных согласий на обработку персональных данных 

Проект разработан для kruzhok.pro в 2020 г.

[![License: MIT](https://img.shields.io/badge/License-MIT-green.svg)](https://opensource.org/licenses/MIT)

## Описание проекта
Данная утилита определяет является ли присланная пользователем форма согласия на обработку персональных данных корректно заполненной. Код не зависит от выбранной формы и нет необходимости его переписывать при работе с формой нового типа - возможна конфигурация "под текущую форму".

### Этапы
1. Попытка развернуть присланную форму так, чтобы она совпадала с шаблонной формой.
2. Определение того, на сколько совпадают присланная пользователем форма и исходная. Если коэффицент совпадения слишком низок, осуществляется выход из программы.
3. Анализ каждого поля в присланной форме на предмет того, является ли оно заполненным. Если процент заполненных полей от общего числа превышает определенный порог, выводит "ok".

![](https://github.com/VladKovalevv/ReadmeNTI/blob/main/return.jpg)

### Основные технические концепции	
- ORB keypoint detector для выделения фич.
- BFMatcher для сопоставления выделенных фич.
- findHomography для разворота изображения по полученным на предыдущих этапах точкам.
- matchTemplate для проверки того, является ли развернутое изображение исходной формой (не прислал ли пользователь что-то левое).
- MSE (mean squared error) для сопоставления полей на присланной форме и исходной. Помогает отделить заполненную форму от незаполненной.

## Начало работы 

### Важная информация
- Текущий скрипт может работать с формами типа 1, 2, 3. Все данные, связанные с ниим, находятся в папке data. Перед работой с новой формой эти данные нужно соответственно дополнить.
  - sogl{номер формы}_image.jpg - сам файл согласия.
  - sogl{номер формы}_orb.pickle - предпросчитанные orb keypoints для последующего использования. Позволяет ускорить время работы скрипта. При необходимости можно рассчитывать их "на ходу".
  - sogl{номер формы}_fields.json - файл с полями для анализа форма [["Название поля", (y2, y1), (x2, x1)], ...]
- Скрипт работает хорошо на формах в качестве не ниже среднего (где можно различить текст). На остальных формах процент ложно отрицательных результатов увеличивается.
- Во избежание большого количества ложно отрицательных результатов порог заполненных полей выбирается равным 80 процентам. Это позволяет не бояться погрешностей в развороте формы и делает скрипт универсальным (работающим на практически любых формах без изменений).

### Установка
- Удостовериться что версия python > 3.5
- ```git clone https://github.com/azarenkovgd/consents-recognition```
- ```cd consents-recognition```
- При необходимости установить venv (virtual enviroment) через ```apt-get install python3-venv```
- Создание venv ```python3 -m venv . ```
- Активация ```source bin/activate```
- Установка требуемых библиотек ```pip install -r requirements.txt```

### Запуск 
- Cкрипт запуска программы - ```main.py```
- Аргументы:
  - ```-f``` если флаг активен, то скрипт будет запущен на всех файлах по указанному пути (path). Если нет, то воспринимает путь (path) как местоположение файла и запустит скрипт на нем.
  - ```path``` путь к файлу согласия (отправленного пользователем) или к папке с файлами согласий.
  - ```number``` номер исходного (незаполненного) согласия (1/2/3).
  - ```-p --parameters``` путь к файлу с параметрами. По умолчанию ```parameters.json```.

### Структура проекта
- ```data``` папка с данными об исходных (незаполненных) согласиях.
- ```fields``` папка с экспериментальной фичей, которая позволяет загружать данные о полях их специально отредактированного файла. 
- ```alignment.py``` файл, содержаший код, выравнивающий отправленную пользователем форму для дальнейшей обработки.
- ```loadsave.py``` вспомогательный файл, содержаший функции для загрузки и сохранения данных.
- ```recognition.py``` файл, содержащий код, который оценивает то, на сколько хорошо была выравнена форма и процент заполненных в ней полей.
- ```main.py``` точка входа, файл, через который происходит тестирование программы.
- ```return.jpg``` файл иллюстраци для README.md.

### Команда
Азаренков Георгий https://github.com/azarenkovgd

Владислав Ковалев https://github.com/VladKovalevv
